<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TanStack Query 入门食用指南 | Zz-ZzzZ</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.0.0-rc.39">
    <link rel="preload stylesheet" href="/assets/style.DEl_5CG4.css" as="style">
    
    <script type="module" src="/assets/app.BXPbzrYG.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Bu8hRsVA.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.D5p3UFKC.js">
    <link rel="modulepreload" href="/assets/chunks/framework.BxrWhBXs.js">
    <link rel="modulepreload" href="/assets/share_query.md.yrVkCWQJ.lean.js">
    <link rel="icon" type="image/svg+xml" href="/logo.svg">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="site" data-v-63c05d4b><div class="site-bg" data-v-63c05d4b></div><div class="site-container" data-v-63c05d4b><div class="site-main" data-v-63c05d4b><!--[--><div class="header" data-v-12b35cbd><span class="header-title" data-v-12b35cbd><img src="/assets/logo.Dm2oxPja.svg" alt="" class="header-icon" data-v-12b35cbd> Zz-ZzzZ </span><div data-v-12b35cbd><img src="data:image/svg+xml,%3c?xml%20version=&#39;1.0&#39;%20standalone=&#39;no&#39;?%3e%3c!DOCTYPE%20svg%20PUBLIC%20&#39;-//W3C//DTD%20SVG%201.1//EN&#39;%20&#39;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&#39;%3e%3csvg%20t=&#39;1686625890617&#39;%20class=&#39;icon&#39;%20viewBox=&#39;0%200%201024%201024&#39;%20version=&#39;1.1&#39;%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%20p-id=&#39;2452&#39;%20xmlns:xlink=&#39;http://www.w3.org/1999/xlink&#39;%20width=&#39;200&#39;%20height=&#39;200&#39;%3e%3cpath%20d=&#39;M0%200h1024v1024H0z&#39;%20fill=&#39;%23FFFFFF&#39;%20fill-opacity=&#39;.01&#39;%20p-id=&#39;2453&#39;%3e%3c/path%3e%3cpath%20d=&#39;M512%2085.333333C276.352%2085.333333%2085.333333%20276.352%2085.333333%20512s191.018667%20426.666667%20426.666667%20426.666667%20426.666667-191.018667%20426.666667-426.666667S747.648%2085.333333%20512%2085.333333zM0%20512C0%20229.226667%20229.226667%200%20512%200s512%20229.226667%20512%20512-229.226667%20512-512%20512S0%20794.773333%200%20512z&#39;%20fill=&#39;%23333333&#39;%20p-id=&#39;2454&#39;%3e%3c/path%3e%3cpath%20d=&#39;M409.237333%20970.048c-4.117333-5.333333-4.117333-52.778667%200-142.357333-44.202667%201.536-72.106667-1.536-83.776-9.194667-17.493333-11.52-34.986667-46.933333-50.496-71.914667-15.530667-24.981333-49.984-28.928-63.893333-34.517333-13.909333-5.589333-17.408-28.330667%2038.336-11.136%2055.744%2017.216%2058.453333%2064.106667%2076.053333%2075.050667%2017.578667%2010.965333%2059.626667%206.186667%2078.698667-2.602667%2019.050667-8.789333%2017.642667-41.472%2021.034667-54.421333%204.309333-12.096-10.837333-14.784-11.178667-14.869334-18.602667%200-116.330667-21.269333-143.189333-115.904-26.837333-94.656%207.744-156.522667%2026.197333-183.125333%2012.288-17.706667%2011.2-55.509333-3.264-113.344%2052.544-6.72%2093.098667%209.813333%20121.664%2049.621333%200.042667%200.213333%2037.44-22.250667%2096.576-22.250666%2059.136%200%2080.106667%2018.304%2096.298667%2022.250666%2016.192%203.946667%2029.141333-69.674667%20129.130666-49.621333-20.885333%2041.024-38.357333%2092.288-25.024%20113.344%2013.354667%2021.077333%2065.706667%2088.064%2033.536%20183.125333-21.44%2063.36-63.573333%20101.994667-126.464%20115.904-7.210667%202.282667-10.816%205.994667-10.816%2011.114667%200%207.68%209.749333%208.533333%2023.786667%2044.522667%209.365333%2023.978667%2010.026667%2092.501333%202.026667%20205.546666-20.266667%205.162667-36.053333%208.618667-47.36%2010.410667-19.989333%203.136-41.685333%204.906667-63.018667%205.568-21.333333%200.682667-28.757333%200.618667-58.24-2.133333a422.357333%20422.357333%200%200%201-56.618667-9.066667z&#39;%20fill=&#39;%23333333&#39;%20p-id=&#39;2455&#39;%3e%3c/path%3e%3c/svg%3e" class="header-github" alt="" data-v-12b35cbd></div></div><div class="header-divider" data-v-12b35cbd></div><!--]--><div class="home" style="display:none;" data-v-63c05d4b><div style="position:relative;" class="vp-doc"><div><h1 id="tanstack-query-入门食用指南" tabindex="-1">TanStack Query 入门食用指南 <a class="header-anchor" href="#tanstack-query-入门食用指南" aria-label="Permalink to &quot;TanStack Query 入门食用指南&quot;">​</a></h1><p>对常见的请求场景进行一个封装，可以跨组件的管理请求状态，并且支持多个框架版本。</p><p>由于V5版本只有纯英文文档，因此在进行阅读后记录它的基本用法，哪天用到了可以快速使用。</p><p>本篇记录的是<code>react-query</code>的用法，其它版本大差不差。</p><h3 id="queryclient-queryclientprovider" tabindex="-1">QueryClient &amp;&amp; QueryClientProvider <a class="header-anchor" href="#queryclient-queryclientprovider" aria-label="Permalink to &quot;QueryClient &amp;&amp; QueryClientProvider&quot;">​</a></h3><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> queryClient</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> QueryClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ReactDOM.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;root&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">React.StrictMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">QueryClientProvider</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{queryClient}&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">App</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">QueryClientProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">React.StrictMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>实例化<code>QueryClient</code>类，此处可传递全局配置。</p><p>使用<code>QueryClientProvider</code>组件注入后，所有子组件就可以通过<code>useQueryClient</code>来进行跨组件操作。</p><h3 id="usequery" tabindex="-1">useQuery <a class="header-anchor" href="#usequery" aria-label="Permalink to &quot;useQuery&quot;">​</a></h3><p><code>query</code>一般用于<code>get</code>请求的场景，页面加载就可以发起请求。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setEnabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isPending</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isFetching</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isLoading</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">refetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 这里可以放不同的数据类型，一般可以将组件的state放进去</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  queryKey: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;useQuery&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 这里会传入一些参数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  queryFn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">queryKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> axios</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 这里需要自行处理response得到的数据，最后就会放到data中</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  enabled,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  placeholderData: keepPreviousData,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  initialData: initialData</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><ul><li><p><code>queryFn</code>为请求函数，无论是使用<code>fetch</code>还是<code>axios</code>只要是返回<code>Promise</code>都可以使用。在调用<code>queryFn</code>时，<code>queryKey</code>会作为参数上下文中的<code>queryKey</code>传给<code>queryFn</code>。 当需要将请求状态更改为<code>error</code>状态时可以在<code>Promise</code>内返回<code>reject</code>或<code>throw new Error</code>。</p></li><li><p><code>queryKey</code>可以用于在其它地方通过<code>queryClient</code>调用或通过其定义的<code>queryKey</code>在变更时重新发起请求，<code>queryKey</code>的数组内支持数字，字符串以及可序列化的对象。</p></li><li><p><code>useQuery</code>会返回请求的状态以及数据源，这里需要注意<code>isPending</code>和<code>isFetching</code>的区别，<code>isPending</code>和<code>devtools/network</code>的<code>pending</code>不同， 它代表的是数据的获取状态，<code>isFetching</code>才是请求的状态。<code>isLoading</code>是<code>isPending &amp;&amp; isFetching</code>的计算值，一般用于惰性发起请求。</p></li></ul><h4 id="惰性请求" tabindex="-1">惰性请求 <a class="header-anchor" href="#惰性请求" aria-label="Permalink to &quot;惰性请求&quot;">​</a></h4><ul><li>当需要惰性（也可以说是根据条件决定）发起请求时，可以定义<code>enabled</code>为组件的<code>state</code>，然后将<code>state</code>放入<code>queryKey</code>当中，也可以从<code>useQuery</code>内使用<code>refetch</code>来手动发起请求，不过官方并不推荐手动发起。</li></ul><h4 id="分页场景" tabindex="-1">分页场景 <a class="header-anchor" href="#分页场景" aria-label="Permalink to &quot;分页场景&quot;">​</a></h4><ul><li>在分页场景下，可以定义<code>placeholderData</code>属性，可以使用自带的<code>keepPreviousData</code>或自定义返回值，这样在切换分页时，在新数据获取之前，可以保留旧的数据。 这个属性可以理解为分页场景下的<code>placeholder</code>。</li></ul><h4 id="初始数据" tabindex="-1">初始数据 <a class="header-anchor" href="#初始数据" aria-label="Permalink to &quot;初始数据&quot;">​</a></h4><ul><li>如果想在发起请求之前放一些假数据或从其它地方得到的数据在那，那么可以定义<code>initialData</code>，数据类型要和<code>data</code>内的相同，支持直接定义或函数返回。</li></ul><h3 id="useinfinitequery" tabindex="-1">useInfiniteQuery <a class="header-anchor" href="#useinfinitequery" aria-label="Permalink to &quot;useInfiniteQuery&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">fetchNextPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">fetchPreviousPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">hasNextPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useInfiniteQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  queryKey: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;infinite&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  queryFn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pageParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> axios</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pageParam).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.data),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  initialPageParam: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    page: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    size: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getNextPageParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">lastPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">allPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pageParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 在此返回下一页的pageParam</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getPreviousPageParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 用法与getNextPageParam一致，但不是必填项</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><ul><li><p><code>queryKey</code>与<code>queryFn</code>和<code>useQuery</code>的用法基本一致，不过<code>queryFn</code>中多了一个<code>pageParam</code>参数可供使用。</p></li><li><p>使用<code>useInfiniteQuery</code>时必须传入<code>initialPageParam</code>和<code>getNextPageParam</code>。<code>initialPageParam</code>为发起请求的初始值，一般为页码和页数或只有页码。 <code>getNextPageParam</code>用于获取下一页数据（如调用了<code>fetchNextPage</code>）时的<code>pageParam</code>，如果后端提供了<code>下一页</code>的字段，那么可以直接使用，若未提供则需要手动对页数进行<code>+1</code>。</p></li><li><p><code>hasNextPage</code>是<code>getNextPageParam</code>返回值，不为<code>undefined</code>或<code>null</code>时都为<code>true</code>。</p></li><li><p>对应<code>NextPage</code>，<code>useInfiniteQuery</code>也提供了<code>getPreviousPageParam</code>以及其它和<code>NextPage</code>相似的功能，不过需要注意的是，<code>getPreviousPageParam</code>不是获取上一页，而是从头部插入数据。</p></li><li><p>在<code>data</code>上和<code>useQuery</code>不同，<code>data</code>则变为一个对象，包含<code>page</code>和<code>pageParams</code>，前者是请求获取的数据源，后者则是每次<code>Next</code>或<code>Previous</code>所得到的<code>pageParam</code></p></li><li><p>需要注意的是这里的<code>page</code>是由每一次获取到的数据一起拼接而成，是一个二维或多维数组，在使用时需注意使用方式。</p></li></ul><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  data?.pages.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">group</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Fragment</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{index}&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*这里才是请求到的数据*/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {group.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{item.value}&gt;{item.label}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;)}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Fragment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="usemutation" tabindex="-1">useMutation <a class="header-anchor" href="#usemutation" aria-label="Permalink to &quot;useMutation&quot;">​</a></h3><p>常用于<code>post</code>场景，需手动发起。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mutateAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mutate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isPending</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useMutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  mutationKey: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;useMutation&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  mutationFn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> axios</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onMutate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {},</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {},</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {},</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onSettled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><ul><li><p><code>mutationKey</code>与<code>mutationFn</code>和<code>query</code>中的用法基本一致，<code>mutationFn</code>的参数来自于<code>mutate</code>或<code>mutateAsync</code>传递的值。</p></li><li><p><code>useMutation</code>具有独特的回调事件，<code>onMutate</code>可以理解为发起请求前需要进行的操作，其余三个回调事件可以对应理解为<code>Promise</code>中的<code>then</code>，<code>catch</code>，<code>finally</code>。</p></li><li><p><code>mutate</code>与<code>mutateAsync</code>的使用方法一致，区别是若想触发<code>useMutation</code>上定义的回调之外的其他回调，<code>mutateAsync</code>可以向使用<code>Promise</code>那样注册<code>then/catch/finally</code>， 而<code>mutate</code>需要作为第二个参数传入其回调事件。</p></li></ul><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mutate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params, {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {},</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {},</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onSettled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></div></div></div><div style="position:relative;display:none;" class="vp-doc site-content" data-v-63c05d4b><div><h1 id="tanstack-query-入门食用指南" tabindex="-1">TanStack Query 入门食用指南 <a class="header-anchor" href="#tanstack-query-入门食用指南" aria-label="Permalink to &quot;TanStack Query 入门食用指南&quot;">​</a></h1><p>对常见的请求场景进行一个封装，可以跨组件的管理请求状态，并且支持多个框架版本。</p><p>由于V5版本只有纯英文文档，因此在进行阅读后记录它的基本用法，哪天用到了可以快速使用。</p><p>本篇记录的是<code>react-query</code>的用法，其它版本大差不差。</p><h3 id="queryclient-queryclientprovider" tabindex="-1">QueryClient &amp;&amp; QueryClientProvider <a class="header-anchor" href="#queryclient-queryclientprovider" aria-label="Permalink to &quot;QueryClient &amp;&amp; QueryClientProvider&quot;">​</a></h3><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> queryClient</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> QueryClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ReactDOM.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;root&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">React.StrictMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">QueryClientProvider</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{queryClient}&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">App</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">QueryClientProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">React.StrictMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>实例化<code>QueryClient</code>类，此处可传递全局配置。</p><p>使用<code>QueryClientProvider</code>组件注入后，所有子组件就可以通过<code>useQueryClient</code>来进行跨组件操作。</p><h3 id="usequery" tabindex="-1">useQuery <a class="header-anchor" href="#usequery" aria-label="Permalink to &quot;useQuery&quot;">​</a></h3><p><code>query</code>一般用于<code>get</code>请求的场景，页面加载就可以发起请求。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setEnabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isPending</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isFetching</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isLoading</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">refetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 这里可以放不同的数据类型，一般可以将组件的state放进去</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  queryKey: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;useQuery&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 这里会传入一些参数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  queryFn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">queryKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> axios</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 这里需要自行处理response得到的数据，最后就会放到data中</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  enabled,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  placeholderData: keepPreviousData,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  initialData: initialData</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><ul><li><p><code>queryFn</code>为请求函数，无论是使用<code>fetch</code>还是<code>axios</code>只要是返回<code>Promise</code>都可以使用。在调用<code>queryFn</code>时，<code>queryKey</code>会作为参数上下文中的<code>queryKey</code>传给<code>queryFn</code>。 当需要将请求状态更改为<code>error</code>状态时可以在<code>Promise</code>内返回<code>reject</code>或<code>throw new Error</code>。</p></li><li><p><code>queryKey</code>可以用于在其它地方通过<code>queryClient</code>调用或通过其定义的<code>queryKey</code>在变更时重新发起请求，<code>queryKey</code>的数组内支持数字，字符串以及可序列化的对象。</p></li><li><p><code>useQuery</code>会返回请求的状态以及数据源，这里需要注意<code>isPending</code>和<code>isFetching</code>的区别，<code>isPending</code>和<code>devtools/network</code>的<code>pending</code>不同， 它代表的是数据的获取状态，<code>isFetching</code>才是请求的状态。<code>isLoading</code>是<code>isPending &amp;&amp; isFetching</code>的计算值，一般用于惰性发起请求。</p></li></ul><h4 id="惰性请求" tabindex="-1">惰性请求 <a class="header-anchor" href="#惰性请求" aria-label="Permalink to &quot;惰性请求&quot;">​</a></h4><ul><li>当需要惰性（也可以说是根据条件决定）发起请求时，可以定义<code>enabled</code>为组件的<code>state</code>，然后将<code>state</code>放入<code>queryKey</code>当中，也可以从<code>useQuery</code>内使用<code>refetch</code>来手动发起请求，不过官方并不推荐手动发起。</li></ul><h4 id="分页场景" tabindex="-1">分页场景 <a class="header-anchor" href="#分页场景" aria-label="Permalink to &quot;分页场景&quot;">​</a></h4><ul><li>在分页场景下，可以定义<code>placeholderData</code>属性，可以使用自带的<code>keepPreviousData</code>或自定义返回值，这样在切换分页时，在新数据获取之前，可以保留旧的数据。 这个属性可以理解为分页场景下的<code>placeholder</code>。</li></ul><h4 id="初始数据" tabindex="-1">初始数据 <a class="header-anchor" href="#初始数据" aria-label="Permalink to &quot;初始数据&quot;">​</a></h4><ul><li>如果想在发起请求之前放一些假数据或从其它地方得到的数据在那，那么可以定义<code>initialData</code>，数据类型要和<code>data</code>内的相同，支持直接定义或函数返回。</li></ul><h3 id="useinfinitequery" tabindex="-1">useInfiniteQuery <a class="header-anchor" href="#useinfinitequery" aria-label="Permalink to &quot;useInfiniteQuery&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">fetchNextPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">fetchPreviousPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">hasNextPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useInfiniteQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  queryKey: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;infinite&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  queryFn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pageParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> axios</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pageParam).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.data),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  initialPageParam: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    page: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    size: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getNextPageParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">lastPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">allPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pageParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 在此返回下一页的pageParam</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getPreviousPageParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 用法与getNextPageParam一致，但不是必填项</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><ul><li><p><code>queryKey</code>与<code>queryFn</code>和<code>useQuery</code>的用法基本一致，不过<code>queryFn</code>中多了一个<code>pageParam</code>参数可供使用。</p></li><li><p>使用<code>useInfiniteQuery</code>时必须传入<code>initialPageParam</code>和<code>getNextPageParam</code>。<code>initialPageParam</code>为发起请求的初始值，一般为页码和页数或只有页码。 <code>getNextPageParam</code>用于获取下一页数据（如调用了<code>fetchNextPage</code>）时的<code>pageParam</code>，如果后端提供了<code>下一页</code>的字段，那么可以直接使用，若未提供则需要手动对页数进行<code>+1</code>。</p></li><li><p><code>hasNextPage</code>是<code>getNextPageParam</code>返回值，不为<code>undefined</code>或<code>null</code>时都为<code>true</code>。</p></li><li><p>对应<code>NextPage</code>，<code>useInfiniteQuery</code>也提供了<code>getPreviousPageParam</code>以及其它和<code>NextPage</code>相似的功能，不过需要注意的是，<code>getPreviousPageParam</code>不是获取上一页，而是从头部插入数据。</p></li><li><p>在<code>data</code>上和<code>useQuery</code>不同，<code>data</code>则变为一个对象，包含<code>page</code>和<code>pageParams</code>，前者是请求获取的数据源，后者则是每次<code>Next</code>或<code>Previous</code>所得到的<code>pageParam</code></p></li><li><p>需要注意的是这里的<code>page</code>是由每一次获取到的数据一起拼接而成，是一个二维或多维数组，在使用时需注意使用方式。</p></li></ul><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  data?.pages.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">group</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Fragment</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{index}&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*这里才是请求到的数据*/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {group.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{item.value}&gt;{item.label}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;)}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Fragment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="usemutation" tabindex="-1">useMutation <a class="header-anchor" href="#usemutation" aria-label="Permalink to &quot;useMutation&quot;">​</a></h3><p>常用于<code>post</code>场景，需手动发起。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mutateAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mutate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isPending</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useMutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  mutationKey: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;useMutation&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  mutationFn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> axios</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onMutate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {},</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {},</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {},</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onSettled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><ul><li><p><code>mutationKey</code>与<code>mutationFn</code>和<code>query</code>中的用法基本一致，<code>mutationFn</code>的参数来自于<code>mutate</code>或<code>mutateAsync</code>传递的值。</p></li><li><p><code>useMutation</code>具有独特的回调事件，<code>onMutate</code>可以理解为发起请求前需要进行的操作，其余三个回调事件可以对应理解为<code>Promise</code>中的<code>then</code>，<code>catch</code>，<code>finally</code>。</p></li><li><p><code>mutate</code>与<code>mutateAsync</code>的使用方法一致，区别是若想触发<code>useMutation</code>上定义的回调之外的其他回调，<code>mutateAsync</code>可以向使用<code>Promise</code>那样注册<code>then/catch/finally</code>， 而<code>mutate</code>需要作为第二个参数传入其回调事件。</p></li></ul><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mutate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params, {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {},</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {},</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onSettled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></div></div></div></div></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"bug_pdfjs.md\":\"BGDzNeAC\",\"bug_inline-block.md\":\"CZYbe4KU\",\"bug_nodesass.md\":\"93A-ofy2\",\"bug_el-date-picker.md\":\"BdM82QW5\",\"bug_formgroup.md\":\"dhnvVEds\",\"bug_regexp.md\":\"DmLdUQEK\",\"bug_safe-area.md\":\"CFoDeriy\",\"code_uai_home.md\":\"DQ-0A1VN\",\"code_vue-demi.md\":\"DHs3TBx4\",\"code_dayjs.md\":\"CwYHBaIe\",\"share_props.md\":\"CJG5k-eS\",\"bug_ts-this.md\":\"BtG8RbM5\",\"code_vuex-persistedstate.md\":\"C6p3_KUS\",\"bug_input-zh.md\":\"B7RjTo_H\",\"index.md\":\"CE7F3VhE\",\"code_uai_transform.md\":\"VTURStGQ\",\"share_copy.md\":\"Dh83qZ1G\",\"code_vue-cli_serve.md\":\"2lqsmuLI\",\"share_event.md\":\"Fvwmy6-K\",\"code_vca.md\":\"DESv9wmp\",\"share_i18n.md\":\"DmqwhEHb\",\"share_inheritattrs.md\":\"CbTY5tw1\",\"share_caniusestyle.md\":\"fSAkl0UM\",\"code_uai_scan.md\":\"Dr4pKHaJ\",\"share_query.md\":\"yrVkCWQJ\",\"code_vue-clamp.md\":\"CZ8BdVe3\",\"code_vue-cli_home.md\":\"B_j1lPce\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Zz-ZzzZ\",\"description\":\"A VitePress site\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>