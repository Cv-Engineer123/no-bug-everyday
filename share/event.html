<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>在不使用Event Bus来实现深层组件嵌套事件通信 | Zz-ZzzZ</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.0.0-rc.39">
    <link rel="preload stylesheet" href="/assets/style.DEl_5CG4.css" as="style">
    
    <script type="module" src="/assets/app.BXPbzrYG.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Bu8hRsVA.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.D5p3UFKC.js">
    <link rel="modulepreload" href="/assets/chunks/framework.BxrWhBXs.js">
    <link rel="modulepreload" href="/assets/share_event.md.Fvwmy6-K.lean.js">
    <link rel="icon" type="image/svg+xml" href="/logo.svg">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="site" data-v-63c05d4b><div class="site-bg" data-v-63c05d4b></div><div class="site-container" data-v-63c05d4b><div class="site-main" data-v-63c05d4b><!--[--><div class="header" data-v-12b35cbd><span class="header-title" data-v-12b35cbd><img src="/assets/logo.Dm2oxPja.svg" alt="" class="header-icon" data-v-12b35cbd> Zz-ZzzZ </span><div data-v-12b35cbd><img src="data:image/svg+xml,%3c?xml%20version=&#39;1.0&#39;%20standalone=&#39;no&#39;?%3e%3c!DOCTYPE%20svg%20PUBLIC%20&#39;-//W3C//DTD%20SVG%201.1//EN&#39;%20&#39;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&#39;%3e%3csvg%20t=&#39;1686625890617&#39;%20class=&#39;icon&#39;%20viewBox=&#39;0%200%201024%201024&#39;%20version=&#39;1.1&#39;%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%20p-id=&#39;2452&#39;%20xmlns:xlink=&#39;http://www.w3.org/1999/xlink&#39;%20width=&#39;200&#39;%20height=&#39;200&#39;%3e%3cpath%20d=&#39;M0%200h1024v1024H0z&#39;%20fill=&#39;%23FFFFFF&#39;%20fill-opacity=&#39;.01&#39;%20p-id=&#39;2453&#39;%3e%3c/path%3e%3cpath%20d=&#39;M512%2085.333333C276.352%2085.333333%2085.333333%20276.352%2085.333333%20512s191.018667%20426.666667%20426.666667%20426.666667%20426.666667-191.018667%20426.666667-426.666667S747.648%2085.333333%20512%2085.333333zM0%20512C0%20229.226667%20229.226667%200%20512%200s512%20229.226667%20512%20512-229.226667%20512-512%20512S0%20794.773333%200%20512z&#39;%20fill=&#39;%23333333&#39;%20p-id=&#39;2454&#39;%3e%3c/path%3e%3cpath%20d=&#39;M409.237333%20970.048c-4.117333-5.333333-4.117333-52.778667%200-142.357333-44.202667%201.536-72.106667-1.536-83.776-9.194667-17.493333-11.52-34.986667-46.933333-50.496-71.914667-15.530667-24.981333-49.984-28.928-63.893333-34.517333-13.909333-5.589333-17.408-28.330667%2038.336-11.136%2055.744%2017.216%2058.453333%2064.106667%2076.053333%2075.050667%2017.578667%2010.965333%2059.626667%206.186667%2078.698667-2.602667%2019.050667-8.789333%2017.642667-41.472%2021.034667-54.421333%204.309333-12.096-10.837333-14.784-11.178667-14.869334-18.602667%200-116.330667-21.269333-143.189333-115.904-26.837333-94.656%207.744-156.522667%2026.197333-183.125333%2012.288-17.706667%2011.2-55.509333-3.264-113.344%2052.544-6.72%2093.098667%209.813333%20121.664%2049.621333%200.042667%200.213333%2037.44-22.250667%2096.576-22.250666%2059.136%200%2080.106667%2018.304%2096.298667%2022.250666%2016.192%203.946667%2029.141333-69.674667%20129.130666-49.621333-20.885333%2041.024-38.357333%2092.288-25.024%20113.344%2013.354667%2021.077333%2065.706667%2088.064%2033.536%20183.125333-21.44%2063.36-63.573333%20101.994667-126.464%20115.904-7.210667%202.282667-10.816%205.994667-10.816%2011.114667%200%207.68%209.749333%208.533333%2023.786667%2044.522667%209.365333%2023.978667%2010.026667%2092.501333%202.026667%20205.546666-20.266667%205.162667-36.053333%208.618667-47.36%2010.410667-19.989333%203.136-41.685333%204.906667-63.018667%205.568-21.333333%200.682667-28.757333%200.618667-58.24-2.133333a422.357333%20422.357333%200%200%201-56.618667-9.066667z&#39;%20fill=&#39;%23333333&#39;%20p-id=&#39;2455&#39;%3e%3c/path%3e%3c/svg%3e" class="header-github" alt="" data-v-12b35cbd></div></div><div class="header-divider" data-v-12b35cbd></div><!--]--><div class="home" style="display:none;" data-v-63c05d4b><div style="position:relative;" class="vp-doc"><div><h1 id="在不使用event-bus来实现深层组件嵌套事件通信" tabindex="-1">在不使用Event Bus来实现深层组件嵌套事件通信 <a class="header-anchor" href="#在不使用event-bus来实现深层组件嵌套事件通信" aria-label="Permalink to &quot;在不使用Event Bus来实现深层组件嵌套事件通信&quot;">​</a></h1><p>在看<code>element-ui</code>的<code>Form</code>组件时发现在其内部实现了一套深层嵌套组件通信的方式，代码位于<code>/src/mixins/emitter.js</code>。</p><p>这个技巧挺有意思的，分享一下，相比<code>Event Bus</code>不会存在事件名冲突的问题。</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    methods: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">componentName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eventName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.$parent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.$root;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parent.$options.componentName;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (parent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> componentName)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                parent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parent.$parent;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (parent) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parent.$options.componentName;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (parent) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                parent.$emit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parent, [eventName].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">concat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>这个<code>mixin</code>的作用是调用此方法后根据提供的<code>componentName</code>向上遍历（<code>componentName</code>是<code>element-ui</code>内自定义的一个组件属性，不一定要用<code>componentName</code>，<code>name</code>也是可以的。）， 最后会得到该组件实例，依靠<code>vm.$emit()和vm.$on()</code>这两个<code>Api</code>来实现组件通信，<code>element-ui</code>内部通过此方法来完成由表单元素向<code>Form</code>传递事件的过程。</p><div class="tip custom-block"><p class="custom-block-title">vm.$on() -- 来自Vue文档</p><p>监听当前实例上的自定义事件。事件可以由 vm.$emit 触发。回调函数会接收所有传入事件触发函数的额外参数。</p></div></div></div></div><div style="position:relative;display:none;" class="vp-doc site-content" data-v-63c05d4b><div><h1 id="在不使用event-bus来实现深层组件嵌套事件通信" tabindex="-1">在不使用Event Bus来实现深层组件嵌套事件通信 <a class="header-anchor" href="#在不使用event-bus来实现深层组件嵌套事件通信" aria-label="Permalink to &quot;在不使用Event Bus来实现深层组件嵌套事件通信&quot;">​</a></h1><p>在看<code>element-ui</code>的<code>Form</code>组件时发现在其内部实现了一套深层嵌套组件通信的方式，代码位于<code>/src/mixins/emitter.js</code>。</p><p>这个技巧挺有意思的，分享一下，相比<code>Event Bus</code>不会存在事件名冲突的问题。</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    methods: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">componentName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eventName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.$parent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.$root;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parent.$options.componentName;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (parent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> componentName)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                parent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parent.$parent;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (parent) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parent.$options.componentName;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (parent) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                parent.$emit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parent, [eventName].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">concat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>这个<code>mixin</code>的作用是调用此方法后根据提供的<code>componentName</code>向上遍历（<code>componentName</code>是<code>element-ui</code>内自定义的一个组件属性，不一定要用<code>componentName</code>，<code>name</code>也是可以的。）， 最后会得到该组件实例，依靠<code>vm.$emit()和vm.$on()</code>这两个<code>Api</code>来实现组件通信，<code>element-ui</code>内部通过此方法来完成由表单元素向<code>Form</code>传递事件的过程。</p><div class="tip custom-block"><p class="custom-block-title">vm.$on() -- 来自Vue文档</p><p>监听当前实例上的自定义事件。事件可以由 vm.$emit 触发。回调函数会接收所有传入事件触发函数的额外参数。</p></div></div></div></div></div></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"bug_pdfjs.md\":\"BGDzNeAC\",\"bug_inline-block.md\":\"CZYbe4KU\",\"bug_nodesass.md\":\"93A-ofy2\",\"bug_el-date-picker.md\":\"BdM82QW5\",\"bug_formgroup.md\":\"dhnvVEds\",\"bug_regexp.md\":\"DmLdUQEK\",\"bug_safe-area.md\":\"CFoDeriy\",\"code_uai_home.md\":\"DQ-0A1VN\",\"code_vue-demi.md\":\"DHs3TBx4\",\"code_dayjs.md\":\"CwYHBaIe\",\"share_props.md\":\"CJG5k-eS\",\"bug_ts-this.md\":\"BtG8RbM5\",\"code_vuex-persistedstate.md\":\"C6p3_KUS\",\"bug_input-zh.md\":\"B7RjTo_H\",\"index.md\":\"CE7F3VhE\",\"code_uai_transform.md\":\"VTURStGQ\",\"share_copy.md\":\"Dh83qZ1G\",\"code_vue-cli_serve.md\":\"2lqsmuLI\",\"share_event.md\":\"Fvwmy6-K\",\"code_vca.md\":\"DESv9wmp\",\"share_i18n.md\":\"DmqwhEHb\",\"share_inheritattrs.md\":\"CbTY5tw1\",\"share_caniusestyle.md\":\"fSAkl0UM\",\"code_uai_scan.md\":\"Dr4pKHaJ\",\"share_query.md\":\"yrVkCWQJ\",\"code_vue-clamp.md\":\"CZ8BdVe3\",\"code_vue-cli_home.md\":\"B_j1lPce\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Zz-ZzzZ\",\"description\":\"A VitePress site\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>